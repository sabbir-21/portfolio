<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <title>Bioinformatics Lab Order</title>
  <link rel="stylesheet" href="style.css">
    <style>
    body {
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }
  </style>
  <script>
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('keydown', e => {
      const key = e.key.toUpperCase();
      if (
        key === 'F12' ||
        (e.ctrlKey && e.shiftKey && ['I', 'J', 'C'].includes(key)) ||
        (e.ctrlKey && key === 'U')
      ) {
        e.preventDefault();
      }
    });
  </script>
</head>
<body>
  <div class="container" id="containerSection">
    <h1 class="orderH1">Bioinformatics Lab</h1>
    <form id="orderForm">
      <label for="complexSlider">Number of Complexes:</label>
      <input type="range" id="complexSlider" min="1" max="20" value="1">
      <span id="complexValue">1</span>
      
      <label for="simulationTime">Simulation Time (ns):</label>
      <select id="simulationTime">
        <option value="50">50ns</option>
        <option value="100" selected>100ns</option>
        <option value="200">200ns</option>
        <option value="300">300ns</option>
        <option value="400">400ns</option>
        <option value="500">500ns</option>
        <option value="1000">1000ns</option>
      </select>
<div class="checkbox-wrapper-2">
      
      <label class="check-box"><input type="checkbox" id="mmgbsaCheckbox"> Calculate MMGBSA (+400৳/complex)</label>
      <label><input type="checkbox" id="dftCheckbox"> Calculate DFT (+1000৳/complex)</label>
      <label><input type="checkbox" id="pcaCheckbox"> Calculate PCA (+500৳/complex)</label>
      <label><input type="checkbox" id="dccmCheckbox"> Calculate DCCM (+500৳/complex)</label>
    </div>

      <h2>Total Price: <span id="originalPrice" style="text-decoration: line-through; display: none;"></span> <span id="finalPrice">1500</span> Taka <span id="discountBadge" style="display: none; background-color: #ffd700; padding: 5px; border-radius: 5px; margin-left: 10px;"></span></h2> <!--33% OFF!-->
      <h3>Estimated Time: <span id="daysDisplay">0</span> Day(s)</h3>

      <label for="fname">Name:</label>
      <input type="text" id="fname" placeholder="Enter your name" required>
      <label for="email">Email:</label>
      <input type="email" id="email" placeholder="Enter your email (For file delivery)" required>
      <label for="promoCode">Promo Code:</label>
      <input type="text" id="promoCode" placeholder="Promo code (Optional)">
      <label for="transaction">Payment Transaction ID:</label>
      <input type="text" id="transaction" placeholder="Transaction ID:" required>
      

      <button class="orderButtonStyle" type="button" id="orderButton">Order Now</button>
    </form>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    const slider = document.getElementById('complexSlider');
    const complexValue = document.getElementById('complexValue');
    const simulationTime = document.getElementById('simulationTime');
    const mmgbsaCheckbox = document.getElementById('mmgbsaCheckbox');
    const dftCheckbox = document.getElementById('dftCheckbox');
    const pcaCheckbox = document.getElementById('pcaCheckbox');
    const dccmCheckbox = document.getElementById('dccmCheckbox');
    const originalPrice = document.getElementById('originalPrice');
    const finalPrice = document.getElementById('finalPrice');
    const discountBadge = document.getElementById('discountBadge');
    const daysDisplay = document.getElementById('daysDisplay');
    const orderButton = document.getElementById('orderButton');
    const emailField = document.getElementById('email');
    const nameField = document.getElementById('fname');
    const transactionField = document.getElementById('transaction');
    const promoCodeField = document.getElementById('promoCode');


    slider.addEventListener('input', updatePrice);
    simulationTime.addEventListener('change', updatePrice);
    mmgbsaCheckbox.addEventListener('change', updatePrice);
    dftCheckbox.addEventListener('change', updatePrice);
    pcaCheckbox.addEventListener('change', updatePrice);
    dccmCheckbox.addEventListener('change', updatePrice);
    promoCodeField.addEventListener('input', updatePrice);

    function updatePrice() {
      const numComplexes = parseInt(slider.value);
      const nsValue = parseInt(simulationTime.value);
      let basePrice = numComplexes * (nsValue / 100) * 2000;

      if (mmgbsaCheckbox.checked) {
        basePrice += numComplexes * 400;
      }
      
      if (dftCheckbox.checked) {
        basePrice += numComplexes * 1000;
      }
      if (pcaCheckbox.checked) {
        basePrice += numComplexes * 500;
      }
      if (dccmCheckbox.checked) {
        basePrice += numComplexes * 500;
      }

      const promoCode = promoCodeField.value;
      const dd = atob("U0FCQklS");
      const de = atob("TUJTVFU=");
      const df = atob("U1BDSUFM");
      const dg = atob("UkVRVUVTVA");

      const ad = atob("MzMlIE9GRiE");
      const ae = atob("MjUlIE9GRiE");
      const af = atob("NTAlIE9GRiE");
      const ag = atob("NzAlIE9GRiE");

      let finalPriceValue = basePrice;
      if (promoCode === dd) {
          const discountedPrice = basePrice * (1 - 0.33333333);
          originalPrice.textContent = basePrice;
          originalPrice.style.display = 'inline';
          finalPrice.textContent = Math.round(discountedPrice);
          discountBadge.textContent = ad;
          discountBadge.style.display = 'inline';
          finalPriceValue = Math.round(discountedPrice);
        } else if (promoCode === de) {
          const discountedPrice = basePrice * 0.75;
          originalPrice.textContent = basePrice;
          originalPrice.style.display = 'inline';
          finalPrice.textContent = Math.round(discountedPrice);
          discountBadge.textContent = ae;
          discountBadge.style.display = 'inline';
          finalPriceValue = Math.round(discountedPrice);
        } else if (promoCode === df) {
          const discountedPrice = basePrice * 0.5;
          originalPrice.textContent = basePrice;
          originalPrice.style.display = 'inline';
          finalPrice.textContent = Math.round(discountedPrice);
          discountBadge.textContent = af;
          discountBadge.style.display = 'inline';
          finalPriceValue = Math.round(discountedPrice);
        } else if (promoCode === dg) {
          const discountedPrice = basePrice * 0.30;
          originalPrice.textContent = basePrice;
          originalPrice.style.display = 'inline';
          finalPrice.textContent = Math.round(discountedPrice);
          discountBadge.textContent = ag;
          discountBadge.style.display = 'inline';
          finalPriceValue = Math.round(discountedPrice);
        } else {
        originalPrice.style.display = 'none';
        finalPrice.textContent = basePrice;
        discountBadge.style.display = 'none';
        finalPriceValue = basePrice;
      }

      complexValue.textContent = numComplexes;
      const days = Math.ceil((numComplexes * (nsValue / 100)) / 2);
      daysDisplay.textContent = days;
    }

    orderButton.addEventListener('click', () => {
      const email = emailField.value;
      const ffname = nameField.value;
      const transaction = transactionField.value;
      const price = finalPrice.textContent;
      const days = daysDisplay.textContent;
      const numComplexes = slider.value;
      const nsValue = simulationTime.value;
      const mmgbsa = mmgbsaCheckbox.checked ? "Yes" : "No";
      const dft = dftCheckbox.checked ? "Yes" : "No";
      const pca = pcaCheckbox.checked ? "Yes" : "No";
      const dccm = dccmCheckbox.checked ? "Yes" : "No";
      const currentDate = new Date();
      const invoiceNumber = currentDate.toISOString().replace(/[-:T.]/g, '').slice(0, 14);
      const formattedDate = currentDate.toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });

      if (email && transaction) {
        orderButton.disabled = true;

        const gForm = atob("aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vZm9ybXMvZC9lLzFGQUlwUUxTZFBTSjdpdWdqZG9OSTUwUkFDeFAzcDBuMjNDWmh6YWlsWFZCQ2dRODFBbG5lRllnL2Zvcm1SZXNwb25zZQ==");
        const formData = new URLSearchParams();
        formData.append('entry.267273701', email);
        formData.append('entry.1164144607', ffname);
        formData.append('entry.1746592776', invoiceNumber);
        formData.append('entry.1369750810', transaction);
        formData.append('entry.1374397848', price);
        formData.append('entry.1240618803', numComplexes);
        formData.append('entry.2026139812', nsValue);
        formData.append('entry.1734846573', mmgbsa);
        formData.append('entry.101306927', dft);
        formData.append('entry.1923996397', pca);
        formData.append('entry.2130868567', dccm);

        fetch(gForm, {
          method: 'POST',
          body: formData,
          mode: 'no-cors',
        }).then(() => {
            displayThankYouMessage({
              email,
              ffname,
              transaction,
              price,
              days,
              numComplexes,
              nsValue,
              mmgbsa,
              dft,
              pca,
              dccm,
              invoiceNumber,
              formattedDate,
            });
        }).catch(() => {
          orderButton.disabled = false;
        });
      } else {
        alert('Please enter your email and transaction ID.');
      }
    });

    function displayThankYouMessage(orderInfo) {
      const container = document.querySelector('.container');
      
      container.innerHTML = 
        `<div class="invoice-box">
			<table cellpadding="0" cellspacing="0">
				<tr class="top">
					<td colspan="2">
						<table>
							<tr>
								<td class="title">
									<text>Bioinformatics Lab</text>
								</td>

								<td>
									<b>Invoice #:</b> ${orderInfo.invoiceNumber}<br/>
									<b>Date:</b> ${orderInfo.formattedDate}
								</td>
							</tr>
						</table>
					</td>
				</tr>

				<tr class="information">
					<td colspan="2">
						<table>
							<tr>
								<td>
									Bioinformatics Lab, Inc.<br />
									RTX 4080<br />
									Schrodinger Suits
								</td>

								<td>
                  <b>Name:</b>	${orderInfo.ffname}<br>
									<b>E-mail:</b>	${orderInfo.email}
								</td>
							</tr>
						</table>
					</td>
				</tr>

        <tr><td align="center" colspan="2">
          <text style="font-size: large;">Your order details are as follows:</text>
        </td></tr>
        <tr class="heading">
					<td>Payment Information</td>

					<td></td>
				</tr>

				<tr class="details">
					<td>Transaction ID</td>

					<td>${orderInfo.transaction}</td>
				</tr>
        <tr class="details">
          <td>Estimated Time:</td>

					<td>${orderInfo.days} day(s)</td>
				</tr>

				<tr class="heading">
					<td>Item</td>

					<td>Price</td>
				</tr>

				<tr class="item">
					<td>Number of Complexes:</td>

					<td>${orderInfo.numComplexes}</td>
				</tr>

				<tr class="item">
					<td>Simulation Time:</td>

					<td>${orderInfo.nsValue} ns</td>
				</tr>
				<tr class="item">
					<td>MMGBSA:</td>

					<td>${orderInfo.mmgbsa}</td>
				</tr>
				<tr class="item">
					<td>DFT:</td>

					<td>${orderInfo.dft}</td>
				</tr>
				<tr class="item">
					<td>PCA:</td>

					<td>${orderInfo.pca}</td>
				</tr>
				<tr class="item last">
					<td>DCCM:</td>

					<td>${orderInfo.dccm}</td>
				</tr>
				
				<tr class="total">
					<td></td>

					<td>Total: &#2547; ${orderInfo.price}</td>
				</tr>
			</table>
      <button class="orderButtonStyle" id="downloadInvoiceButton">Download Your Invoice</button>
		</div>`;

      const downloadInvoiceButton = document.getElementById('downloadInvoiceButton');
      downloadInvoiceButton.addEventListener('click', () => {
        const containerSection = document.getElementById('containerSection');
        
        // Add a slight delay to ensure content is fully rendered
    setTimeout(() => {
      html2canvas(containerSection).then((canvas) => {
        console.log('Canvas generated');
        const link = document.createElement('a');
        link.download = `invoice_${orderInfo.invoiceNumber}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
        console.log('Download initiated');
      }).catch((error) => {
        console.error('Error generating canvas:', error);
      });
    }, 100); // 100ms delay
  });
    }

    // Initial update to set correct values on page load
    updatePrice();

  </script>
</body>
</html>